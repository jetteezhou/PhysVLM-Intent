# 统一Web应用使用指南

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

注意：统一应用需要 `flask-socketio` 支持WebSocket实时通信。

### 2. 启动统一应用

```bash
python start_unified_app.py
```

或者直接运行：

```bash
python unified_server.py
```

### 3. 访问应用

打开浏览器访问：**http://localhost:5000**

## 📋 功能模块

统一应用包含三个主要模块：

### 1. 📹 数据采集

- **功能**：管理采集任务和视频数据
- **使用方式**：通过iframe嵌入现有的数据采集工具
- **主要操作**：
  - 创建和管理任务模板
  - 创建和管理场景类型
  - 创建采集任务
  - 扫描和管理视频文件

### 2. 🎬 标注生成（Pipeline）

- **功能**：运行Pipeline自动生成标注
- **特色功能**：
  - ✅ 从采集任务中选择视频
  - ✅ 实时进度显示（进度条）
  - ✅ 实时日志显示
  - ✅ WebSocket实时更新
  - ✅ 完成后自动跳转到标注检验页面

**使用步骤**：
1. 选择视频来源（从采集任务中选择 或 上传视频文件）
2. 如果选择"从采集任务中选择"：
   - 选择采集任务
   - 从视频列表中选择要处理的视频
3. 点击"开始生成标注"按钮
4. 观察进度条和日志
5. 处理完成后，可以前往标注检验页面查看结果

### 3. ✏️ 标注检验

- **功能**：人工检验和修正标注结果
- **使用方式**：通过iframe嵌入现有的标注工具
- **主要操作**：
  - 查看自动生成的标注结果
  - 点击图像修正物品定位点
  - 编辑物品描述和标签
  - 保存修正结果

## 🔄 完整工作流

1. **数据采集** → 创建采集任务，上传视频文件
2. **标注生成** → 选择视频，运行Pipeline，观察进度
3. **标注检验** → 查看结果，修正标注，保存

## 🎯 Pipeline进度显示

Pipeline处理页面提供以下功能：

- **进度条**：实时显示处理进度（0-100%）
- **当前步骤**：显示当前正在执行的步骤
- **处理日志**：实时显示处理日志，包括：
  - 时间戳
  - 步骤名称
  - 处理消息
  - 成功/错误/警告标识

### 进度步骤说明

1. **预处理** (10%) - 视频预处理，提取音频和视频
2. **语音识别** (30%) - ASR语音识别
3. **视频处理** (60%) - 视频分割和帧采样
4. **意图分析** (80%) - LLM分析视频意图和物品描述
5. **物品定位** (95%) - 定位物品位置
6. **完成** (100%) - Pipeline处理完成

## 🔧 技术架构

- **后端**：Flask + Flask-SocketIO
- **前端**：HTML + JavaScript + Socket.IO客户端
- **实时通信**：WebSocket（用于Pipeline进度更新）

## 📝 注意事项

1. **视频文件路径**：确保选择的视频文件路径正确
2. **API配置**：确保已配置必要的API密钥（DashScope、OpenAI等）
3. **网络连接**：Pipeline处理需要网络连接调用API
4. **处理时间**：Pipeline处理时间取决于视频长度和API响应速度

## 🐛 故障排除

### Pipeline无法启动

- 检查视频文件是否存在
- 检查API密钥是否正确配置
- 查看浏览器控制台的错误信息

### 进度不更新

- 检查WebSocket连接是否正常
- 刷新页面重新连接
- 查看服务器日志

### iframe页面无法加载

- 检查服务器是否正常运行
- 检查HTML文件路径是否正确
- 查看浏览器控制台的错误信息

## 🔄 后续改进计划

- [ ] 支持文件上传功能
- [ ] 更精确的Pipeline进度回调
- [ ] 整合数据采集和标注工具到统一页面（移除iframe）
- [ ] 添加任务历史记录
- [ ] 支持批量处理多个视频

## 📞 支持

如有问题，请查看项目文档或提交Issue。

